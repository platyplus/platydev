# ! ########################################################################### ! #
# ! #|     THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY     |# ! #
# ! ########################################################################### ! #

FROM node:14-alpine
RUN npm i lerna -g --loglevel error
USER node
RUN mkdir /home/node/app
WORKDIR /home/node/app

COPY --chown=node:node package.json yarn.* lerna.json tsconfig.json tsconfig.build.json .eslintrc.js .eslintignore ./
#{{#each dependencies}}
COPY --chown=node:node {{this.directory}}/{{this.name}}/package.json {{this.directory}}/{{this.name}}/yarn.* {{this.directory}}/{{this.name}}/
#{{/each}}
COPY --chown=node:node {{directory}}/{{name}}/package.json {{directory}}/{{name}}/yarn.* /home/node/app/{{directory}}/{{name}}/

RUN yarn
#{{#each dependencies}}
COPY --chown=node:node {{this.directory}}/{{this.name}} /home/node/app/{{this.directory}}/{{this.name}}
#{{/each}}
COPY --chown=node:node {{directory}}/{{name}} /home/node/app/{{directory}}/{{name}}

# RUN yarn workspace {{package}} add typescript@'<4.1' && yarn build
RUN yarn build

CMD yarn workspace {{package}} start --hostname 0.0.0.0
